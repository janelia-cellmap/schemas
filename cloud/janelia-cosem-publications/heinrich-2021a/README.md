# Automatic whole cell organelle segmentation in volumetric electron microscopy

## Contents

This directory contains raw FIB-SEM data, foreground/background masks, hand-annotated ground-truth, predictions, refined segmentations, and analysis volumes used to generate the results described in [Heinrich et al., 2021](https://www.biorxiv.org/content/10.1101/2020.11.14.382143v1).

### Organization of this directory

For each dataset listed at the top level of this directory, we provide some or all of the following sources of data, all of which should embed in the same physical coordinate space:
* FIB-SEM data: FIB-SEM volumes that have been aligned and minimally preprocessed.

* Light microscopy (LM) data: For some datasets, samples were imaged with light microscopy prior to the acquisition of FIB-SEM images. These LM volumes typically contain multiple channels that each represent a fluorescently labelled organelle or subcellular structure. 

* Ground-truth: Regions of the raw FIB-SEM volume wherein every voxel has been labelled by a human annotator. These annotations are used to train machine learning models. There are typically many ground-truth volumes per FIB-SEM dataset. Within each volume, voxels are assigned a class such as Endoplasmic Reticulum (ER), Mitochondira (mito), Plasma Membrane (PM), etc.

* Predictions: A collection of volumes, one per label class, each of which is a soft segmentation of the FIB-SEM data for a particular object class. These volumes are generated by machine learning models trained on the ground truth data described above. Typically these volumes are a scalar field of `uint8` values that are high at a location inside an instance of an object class and low at a location outside an instance of an object class. 

* Refined segmentations: A collection of volumes, one per label class, each of which is a putative segmentation of the FIB-SEM data for a particular object class. In these volumes, each instance of a class is given a unique integral ID, which enables analyses like counting organelles or quantifying their relative distances. These volumes are generated by post-processing prediction volumes. 

To facilitate visualization, each volume type (e.g, raw FIB-SEM data) is saved as a collection of arrays ("dataset" in n5 parlance) with decreasing resolutions; `s0` is the dataset with highest resolution, `s1` is half resolution, etc. This structure is schematized with the following tree diagram:  

<pre>
<font color="#34a434"># structure of a multiresolution n5 group </font> 
├── <font color="#3465A4"><b>volume_name</b></font> <font color="#34a434"> # n5 group </font> 
│   ├── <font color="#3465A4"><b>s0</b></font><font color="#34a434"> # n5 dataset containing highest resolution data </font> 
│   ├── <font color="#3465A4"><b>s1</b></font><font color="#34a434"> # n5 dataset containing second-highest resolution data </font> 
┊   ┊
│   ├── <font color="#3465A4"><b>s{n}</b></font><font color="#34a434"> # n5 dataset containing lowest resolution data </font> 
</pre>

<pre>
<font color="#34a434"> # organization of datasets in cloud storage </font>
<font color="#3465A4"><b>s3://janelia-cosem-publications/heinrich-2021a</b></font>
├──<font color="#3465A4"><b>{dataset}</b></font>
│  ├── <font color="#3465A4"><b>{dataset}.n5</b></font> <font color="#34a434"># root n5 container </font>
│  │   ├── <font color="#3465A4"><b>volumes</b></font> <font color="#34a434"># Image volumes </font>
│  │   │   ├── <font color="#3465A4"><b>raw</b></font> <font color="#34a434"># FIB-SEM data </font>
│  │   │   ├── <font color="#3465A4"><b>masks</b></font> <font color="#34a434"># [optional] binary foreground / background masks for raw data </font>
│  │   │   ├── <font color="#3465A4"><b>subsampled</b></font> <font color="#34a434"># [optional] Downsampled FIB-SEM data </font>
│  │   │   ├── <font color="#3465A4"><b>groundtruth</b></font> <font color="#34a434"># [optional] Ground truth crops </font>
│  │   │   ├── <font color="#3465A4"><b>labels</b></font> <font color="#34a434"># raw predictions, refined segmentations, analysis volumes </font>
│  │   │   │   ├── <font color="#3465A4"><b>{class}_pred</b></font> <font color="#34a434"># raw predictions for an organelle class (e.g., er) </font>
│  │   │   │   ├── <font color="#3465A4"><b>{class}_seg</b></font> <font color="#34a434"># refined segmentation for organelle class (e.g., er) </font>
│  │   │   │   ├── <font color="#3465A4"><b>...</b></font> <font color="#34a434"> # Analysis volumes, e.g. maps of organelle-organelle contact sites</font>
│  ┊   ┊   ┊   ┊
│  │   │   └── <font color="#3465A4"><b>lm</b></font> <font color="#34a434"># [optional] light microscopy data </font>
│  │   │      ├── <font color="#3465A4"><b>{class}_palm</b></font> <font color="#34a434"> # PALM microscopy data of a labelled subcellular structure (e.g.,  er) </font>
│  ┊   ┊      ┊
</pre>

### Ground truth data

COSEM uses human-generated ground truth for training machine-learning models. Ground truth volumes are generated by extracting small (~1 cubic micron) cuboids (called "crops") of raw FIB-SEM data and assigning a semantic label (represented as an integer ID) to every voxel in the crop. Only a few datasets were used as sources of ground truth. For those datasets that have ground truth data, the ground truth crops can be found at the following path structure (parametrized over dataset and crop name):  

`s3://janelia-cosem-publications/heinrich-2021a/{dataset}/{dataset}.n5/volumes/groundtruth/0003/{crop_name}/labels/all`, where `{crop_name}` is something like `Crop1` (see an example crop directory [here](https://open.quiltdata.com/b/janelia-cosem-publications/tree/heinrich-2021a/jrc_hela-2/jrc_hela-2.n5/volumes/groundtruth/0003/)).  The name and quantities of the crops varies across datasets. We intend to add metadata to each crop that expresses the contents (i.e., the label classes) contained in that volume. 

| Individual Class ID: | Combined Class ID:  |
| -------------------- | ------------------  |
| 1: ECS	| 1: ECS = 1  |
| 2: PMe	| 2: PM = 2  |
| 3: Mito mem	| 3: Mito mem = 3  |
| 4: Mito lum	| 4: Mito = 3 + 4 + 5  |
| 5: Mito Ribo	| 5: Mito Ribo = 5  |
| 6: Golgi mem	| 6: Golgi mem = 6  |
| 7: Golgi lum	| 7: Golgi = 6 + 7  |
| 8: Vesicle mem	| 8: Vesicle mem = 8  |
| 9: Vesicle lum	| 9: Vesicle = 8 + 9  |
| 10: Endo mem	| 10: Endo mem = 10  |
| 11: Endo lum	| 11: Endo = 10 + 11  |
| 12: Lyso mem	| 12: Lyso mem = 12  |
| 13: Lyso lum	| 13: Lyso = 12 + 13  |
| 14: LD mem	| 14: LD mem = 14  |
| 15: LD lum	| 15: LD = 14 + 15  |
| 16: ER mem	| 16: ER mem = 16 + 18 + 20  |
| 17: ER lum	| 17: ER = 16 + 17 + 18 + 19 + 20 + 21 + 22 + 23  |
| 18: ERES mem	| (18: ERES mem = 18)  |
| 19: ERES lum	| 19: ERES = 18 + 19  |
| 20: NE mem	| (20: NE mem = 20 + 22 + 23)  |
| 21: NE lum	| 21: NE = 20 + 21 + 22 + 23  |
| 22: NP out	| 22: NP out = 22  |
| 23: NP in	| 23: NP = 22 + 23  |
| 24: H Chrom	| 24: Chromatin = 24 + 25 + 26 + 27 (+ 36)  |
| 25: N-H Chrom	| 25: N-H Chrom = 25  |
| 26: E Chrom	| 26: E Chrom = 26  |
| 27: N-E Chrom	| 27: N-E Chrom = 27  |
| 28: Nucleoplasm	| 28: Nucleus = 20 + 21 + 22 + 23 + 24 + 25 + 26 + 27 + 28 + 29 (+ 36)  |
| 29: Nucleolus	| 29: Nucleolus = 29  |
| 30: MT out	| 30: MT = 30 + 31 + 36  |
| 31: Centrosome	| 31: Centrosome = 31 + 32 + 33  |
| 32: Centrosome D App	| 32: Centrosome D App = 32  |
| 33: Centrosome SD App	| 33: Centrosome SD App = 33  |
| 34: Ribo	| 34: Ribo = 34  |
| 35: Cytosol	| 
| 36: MT in |	
| 37: Nucleus combined	|

### Predictions, and refined segmentations,  analysis volumes

Below is a table listing the prefixes denoting the different classes represented by volumes in `{dataset}.n5/labels`. For some classes that represent biological entities, e.g. `er` (endoplasmic reticulum) or `np` (nuclear pores), volumes with an additional suffix like `er_pred` and `er_seg` may exist, which represent the predictions and refined segmentations for that biological class. Other classes, represent the results of specific analyses, e.g. `er_mito_contacts`; for these classes, there is no suffix applied. 

| class name | description  |
| ---------- | -----------  |
| cent | Centrosome |
| cent-dapp | Centrosome Distal Appendage |
| cent-sdapp | Centrosome Subdistal Appendage |
| chrom | Chromatin |
| er | Endoplasmic Reticulum |
| er_palm | Light Microscopy (PALM) of ER |
| er_sim | Light Microscopy (SIM) of the ER |
| er-mem | Endoplasmic Reticulum membrane |
| eres | Endoplasmic Reticulum Exit Sites |
| eres-mem | Endoplasmic Reticulum Exit Site membrane |
| endo | Endosomal Network |
| endo-mem | Endosome membrane |
| echrom | Euchromatin |
| ecs | Extracellular Space |
| golgi | Golgi |
| golgi-mem | Golgi membrane |
| hchrom | Heterochromatin |
| ld | Lipid Droplet |
| ld-mem | Lipid Droplet membrane |
| lyso | Lysosome |
| lyso-mem | Lysosome membrane |
| mt | Microtubule |
| mt-in | Microtubule inner |
| mt-out | Microtubule outer |
| mito | Mitochondria |
| mito_palm | Light Microscopy (PALM) of Mitochondria |
| mito_sim | Light Microscopy (SIM) of Mitochondria |
| mito-mem | Mitochondria membrane |
| mito-ribo | Mitochondria Ribosome |
| ne | Nuclear Envelope |
| ne-mem | Nuclear Envelope membrane |
| np | Nuclear Pore |
| np-in | Nuclear Pore inner |
| np-out | Nuclear Pore outer |
| nucleolus | Nucleoulus |
| nechrom | Nucleoulus associated Euchromatin |
| nhchrom | Nucleoulus associated Heterochromatin |
| nucleus | Nucleus |
| pm | Plasma Membrane |
| ribo | Ribosome |
| vesicle | Vesicle |
| vesicle-mem | Vesicle membrane |
| er_ribo_contacts | ER - Ribosome Contact Sites |
| er_golgi_contacts | ER - Golgi Contact Sites |
| er_mito_contacts | ER - Mito Contact Sites |
| endo_er_contacts | Endosome - ER Contact Sites |
| er_nucleus_contacts | ER - Nucleus Contact Sites |
| er_pm_contacts | ER - Plasma Membrane Contat Sites |
| er_vesicle_contacts | ER - Vesicle Contact Sites |
| golgi_vesicle_contacts | Golgi - Vesicle Contact Sites |
| endo_golgi_contacts | Endosome - Golgi Contact Sites |
| mito_pm_contacts | Mito - Plasma Membrane Contact Sites |
| er_mt_contacts | ER - Microtubule Contact Sites |
| endo_mt_contacts | Endosome - Microtubule Contact Sites |
| golgi_mt_contacts | Golgi - Microtubule Contact Sites |
| mito_mt_contacts | Mitochondria - Microtubule Contact Sites |
| mt_nucleus_contacts | Microtubule - Nucleus Contact Sites |
| mt_vesicle_contacts | Microtubule - Vesicle Contact Sites |
| mt_pm_contacts | Microtubule - Plasma Membrane Contact Sites |
| mito_skeleton | Mitochrondria Skeletons |
| mito_skeleton-lsp | Mitochrondria Skeletons: Longest Shortest Path |
| er_medial-surface | ER Medial Surface |
| er_curvature | Reconstructed ER from Medial Surface with Curvature |
| ribo_classified | Ribosomes classified by contact surface |
 
