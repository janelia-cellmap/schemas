# COSEM metadata

## Dataset spatial metadata

Image datasets stored in n5 should contain a `transform` attribute, which stores 
the transformation from pixel to physical coordinates as a collection of C-ordered lists:

```json 
"transform": {
    "axes": [ "x", "y", "z" ], 
    "scale": [ <x-resolution>, <y-resolution> <z-resolution> ],
    "translate": [ <x-offset>, <y-offset>, <z-offset> ],
    "units": [ <x-units>, <y-units>, <z-units> ]
}
```

Optionally, datasets may contain n5-viewer style metadata for backward-compatibility. Note that these dimensional values will be F-ordered.

```json
"pixelResolution": {
    [ <x-resolution>, <y-resolution> <z-resolution> ],
    "unit": <spatial-units>
}
```


## Dataset visualization metadata

Visualization metadata for datasets is currently not stored directly in dataset metadata but rather in the `s3://<bucket-name>/<dataset name>/index.json` file. This is because we are storing some datasets in the neuroglancer precomputed format which does not explicitly allow storing arbitrary metadata, like visualization-related metadata. Each element of the visualization metadata obeys the following schema: 

```json
"displaySettings": {
    "color": <string>,
    "contrastLimits": {"min": <double>, "max": <double>}
    "invertColormap": <true/false>
}
```

## Multiscale images (pyramids)

Multiscale images, or scale pyramids, or image pyramids ([wikipedia](https://en.wikipedia.org/wiki/Pyramid_%28image_processing%29)), 
are a convenient representation of large image datasets. Typically, a pyramid with `N` levels is generated by
downsampling an original image `N - 1` times.

Scales must be stored in a shared parent folder as separate n5 datasets with a names `s{N}`, where `N` is the scale level starting at `s0`
(full/highest resolution). An example folder structure is shown below

```
└─ parent
    ├── (required) s0 
    ├── (required) s1 
    ...
    └── (required) s{N-1}

```

### Multiscale metadata

Parent folders containing a scale pyramid themselves will contain n5 attributes that describe all the scales
they contain as follows:

```json
"multiscales": [
    {
        "datasets" : [
            {
                "path": "s0",
                "transform" : <s0-transform>
            },
            {
                "path": "s1",
                "transform" : <s1-transform>
            },
            ...
            {
                "path": "s{N-1}",
                "transform" : <s{N-1}-transform>
            },
        ]
    }
],
"scales": [
    [ 1, 1, 1 ],
    [ <s1_downsampling_factor_x>, <s1_downsampling_factor_y>, <s1_downsampling_factor_z>
    ],
    ...
    [ <s{N-1}_downsampling_factor_x>, <s{N-1}_downsampling_factor_y>, <s{N-1}downsampling_factor_z>
]
```

